<!doctype html><html class="" data-reactroot=""><head>
<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" name="description" content="欢迎来到我的博客，这里搜集了我的技术文章和生活感悟，欢迎一起交流成长。"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/>
<title data-react-helmet="true">npm 语义化版本号 · 流浪小猫的博客</title>
<link data-react-helmet="true" rel="stylesheet" href="/assets/index.css"/><link data-react-helmet="true" id="prismTheme" rel="stylesheet" href="/assets/prism.css"/>
<script data-react-helmet="true" >
    const shouldSetIsDark = document.cookie.includes('is_dark=1') ? true : document.cookie.includes('is_dark=0') ? false : window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (shouldSetIsDark) {
      document.documentElement.classList.add('is_dark');
      document.getElementById('prismTheme').href = "/assets/prism_tomorrow.css";
    }
  </script>
</head><body><a class="czs-menu-l show_on_mobile aside_button_open" href="#" style="background-image:url(&quot;/assets/czs-menu-l.svg&quot;)"></a><a class="show_on_mobile aside_button_text" href="/">流浪小猫的博客</a><aside class="hide_on_mobile"><a class="czs-menu-l show_on_mobile aside_button_close" href="#" style="background-image:url(&quot;/assets/czs-close-l.svg&quot;)"></a><h1><a href="/">流浪小猫的博客</a></h1><p class="description">欢迎来到我的博客，这里搜集了我的技术文章和生活感悟，欢迎一起交流成长。</p><ul class="social list_style_none"><li class="flex_center"><a class="czs-github-logo" href="https://github.com/xcatliu" target="_blank" style="background-image:url(&quot;/assets/czs-github-logo.svg&quot;)"></a></li><li class="flex_center"><a class="czs-message-l" href="mailto:xcatliu@gmail.com" target="_blank" style="background-image:url(&quot;/assets/czs-message-l.svg&quot;)"></a></li><li class="flex_center"><a class="czs-twitter" href="https://twitter.com/xcatliu" target="_blank" style="background-image:url(&quot;/assets/czs-twitter.svg&quot;)"></a></li><li style="flex-grow:1"></li><li class="toggle_dark flex_center"><span class="czs-sun" style="background-image:url(&quot;/assets/czs-sun.svg&quot;)"></span><span class="czs-sun-l" style="background-image:url(&quot;/assets/czs-sun-l.svg&quot;)"></span><span class="czs-moon" style="background-image:url(&quot;/assets/czs-moon.svg&quot;)"></span><span class="czs-moon-l" style="background-image:url(&quot;/assets/czs-moon-l.svg&quot;)"></span></li></ul><nav><ul class="menu list_style_none"><li><a class="flex_center" href="/"><span class="czs-home-l" style="background-image:url(&quot;/assets/czs-home-l.svg&quot;)"></span>首页</a></li><li><a class="flex_center" href="/categories/"><span class="czs-category-l" style="background-image:url(&quot;/assets/czs-category-l.svg&quot;)"></span>分类</a></li><li><a class="flex_center" href="/tags/"><span class="czs-tag-l" style="background-image:url(&quot;/assets/czs-tag-l.svg&quot;)"></span>标签</a></li><li><a class="flex_center" href="/about/"><span class="czs-about-l" style="background-image:url(&quot;/assets/czs-about-l.svg&quot;)"></span>关于</a></li><li><a class="flex_center" href="/archives/"><span class="czs-box-l" style="background-image:url(&quot;/assets/czs-box-l.svg&quot;)"></span>归档</a></li><li><a class="flex_center" href="/links/"><span class="czs-link-l" style="background-image:url(&quot;/assets/czs-link-l.svg&quot;)"></span>友情链接</a></li></ul></nav></aside><section class="main"><h1>npm 语义化版本号</h1><div class="main_post_meta"><time dateTime="Tue Apr 14 2015 00:00:00 GMT+0000 (UTC)">2015-04-15</time> · <!-- -->xcatliu</div><article><blockquote>
<p>本文开始介绍了 <a href="https://npmjs.com">npm</a> 中语义化版本号的格式，然后对如何升级版本号进行了归纳，最后总结了如何正确的定义依赖的版本号。</p>
</blockquote>
<h2 id="%E8%AE%A4%E8%AF%86-npm-%E7%89%88%E6%9C%AC%E5%8F%B7">认识 <a href="https://npmjs.com">npm</a> 版本号<a class="anchor" href="#%E8%AE%A4%E8%AF%86-npm-%E7%89%88%E6%9C%AC%E5%8F%B7">§</a></h2>
<p>每一个 node package 都有自己的版本号，一般定义在项目的 <code>package.json</code> 中，如：</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"express"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Fast, unopinionated, minimalist web framework"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"4.12.3"</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"TJ Holowaychuk &lt;<a class="token email-link" href="mailto:tj@vision">tj@vision</a>-media.ca>"</span><span class="token punctuation">,</span>
  <span class="token property">"..."</span><span class="token operator">:</span> <span class="token string">"..."</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="%E7%89%88%E6%9C%AC%E5%8F%B7%E7%9A%84%E6%A0%BC%E5%BC%8F">版本号的格式<a class="anchor" href="#%E7%89%88%E6%9C%AC%E5%8F%B7%E7%9A%84%E6%A0%BC%E5%BC%8F">§</a></h2>
<p><a href="https://npmjs.com">npm</a> 基本遵守 <a href="http://semver.org">semver</a> 语义化版本号的规则，使用 <a href="https://github.com/npm/node-semver">node-semver</a> 来解析版本号。</p>
<p>一般来说，一个版本号包含三个部分：</p>
<pre class="language-autoit"><code class="language-autoit">MAJOR<span class="token punctuation">.</span>MINOR<span class="token punctuation">.</span>PATCH
</code></pre>
<p>MAJOR 表示主版本号，MINOR 表示次版本号，PATCH 表示修订号。</p>
<p>它们的取值为非负整数，若大于零，不能在前方补零。</p>
<p>另外版本号中任何位置都不能有空格。</p>
<h3 id="%E5%85%88%E8%A1%8C%E7%89%88%E6%9C%AC%E5%8F%B7pre-release-version">先行版本号（Pre-release Version）<a class="anchor" href="#%E5%85%88%E8%A1%8C%E7%89%88%E6%9C%AC%E5%8F%B7pre-release-version">§</a></h3>
<p>作为额外规则，先行版本号可以作为发布正式版之前的版本，格式是在修订版本号后面加上一个连接号（<code>-</code>），再加上一连串以点（<code>.</code>）分割的标识符，标识符可以由英文、数字和连接号（<code>[0-9A-Za-z-]</code>）组成。</p>
<p>同样若数字大于零，不能在前方补零，版本号中任何位置都不能有空格。</p>
<p>举例如下：</p>
<pre class="language-shell"><code class="language-shell"><span class="token number">1.0</span>​​.0-alpha
<span class="token number">1.0</span>.0-alpha.1
<span class="token number">1.0</span>.0-0.3.7
<span class="token number">1.0</span>.0-x.7.z.92
</code></pre>
<p>另外，以下列出了一些常见的先行版本号名称：</p>
<ul>
<li><code>alpha</code></li>
<li><code>beta</code></li>
<li><code>rc</code></li>
</ul>
<h3 id="%E7%89%88%E6%9C%AC%E7%BC%96%E8%AF%91%E4%BF%A1%E6%81%AFbuild-metadata">版本编译信息（Build Metadata）<a class="anchor" href="#%E7%89%88%E6%9C%AC%E7%BC%96%E8%AF%91%E4%BF%A1%E6%81%AFbuild-metadata">§</a></h3>
<p>版本编译信息是另一个额外规则，格式是在修订版本号或先行版本号后面加上一个加号（<code>+</code>），再加上一连串以点（<code>.</code>）分割的标识符，标识符可以由英文、数字和连接号（<code>[0-9A-Za-z-]</code>）组成。</p>
<p>版本号中任何位置都不能有空格（数字表示编译信息，是可以在开头存在多个零的）。</p>
<p>举例如下：</p>
<pre class="language-shell"><code class="language-shell"><span class="token number">1.0</span>.0-alpha+001
<span class="token number">1.0</span>.0+20130313144700
<span class="token number">1.0</span>.0-beta+exp.sha.5114f85
</code></pre>
<h3 id="%E4%B8%80%E4%BA%9B%E6%8B%93%E5%B1%95%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%B7%E8%A7%84%E5%88%99">一些拓展的版本号规则<a class="anchor" href="#%E4%B8%80%E4%BA%9B%E6%8B%93%E5%B1%95%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%B7%E8%A7%84%E5%88%99">§</a></h3>
<p>以上为标准的 <a href="http://semver.org">semver</a> 规则。阅读 <a href="https://github.com/npm/node-semver">node-semver</a> 源码后，发现它对 <a href="http://semver.org">semver</a> 有了一些拓展：</p>
<ol>
<li>允许版本号中大于零的数字以零开头</li>
<li>允许以 <code>v</code> 开头</li>
<li>允许以 <code>=</code> 开头</li>
<li>允许 <code>v</code> 或 <code>=</code> 与版本号之间有空字符串</li>
<li>允许在开头包含空字符串</li>
<li>上面四个规则中，<code>v</code>、<code>=</code> 和空字符串都允许出现多次</li>
</ol>
<p>更深入的讲，<a href="https://github.com/npm/node-semver">node-semver</a> 提供了两种模式，普通模式和宽松模式，普通模式包含了上面 2 的拓展，宽松模式包含了以上所有拓展。</p>
<p><a href="https://npmjs.com">npm</a> 使用的是 <a href="http://semver.org">semver</a> 的宽松模式。</p>
<p>具体内容可以阅读源码了解。</p>
<h2 id="%E5%A6%82%E4%BD%95%E5%8D%87%E7%BA%A7%E7%89%88%E6%9C%AC%E5%8F%B7">如何升级版本号<a class="anchor" href="#%E5%A6%82%E4%BD%95%E5%8D%87%E7%BA%A7%E7%89%88%E6%9C%AC%E5%8F%B7">§</a></h2>
<p>升级版本号的规则主要有三个：</p>
<ol>
<li>主版本号：当你做了不兼容的 API 修改</li>
<li>次版本号：当你做了向下兼容的功能性新增</li>
<li>修订号：当你做了向下兼容的问题修正</li>
</ol>
<h3 id="%E5%BC%80%E5%8F%91%E9%98%B6%E6%AE%B5%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%B7">开发阶段的版本号<a class="anchor" href="#%E5%BC%80%E5%8F%91%E9%98%B6%E6%AE%B5%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%B7">§</a></h3>
<p>主版本号为零的时候，属于开发阶段，一切都可能随时改变，故以上三个规则也不一定适用。</p>
<p>一般来说，修订号的修改仍然保持向下兼容，但是次版本号就不一定向下兼容了。</p>
<h3 id="%E5%85%88%E8%A1%8C%E7%89%88%E6%9C%AC%E5%8F%B7">先行版本号<a class="anchor" href="#%E5%85%88%E8%A1%8C%E7%89%88%E6%9C%AC%E5%8F%B7">§</a></h3>
<p>先行版本号一般用于发布一个新的主版本号（比如 <code>1.0.0</code>、<code>2.0.0</code>、<code>3.0.0</code>）之前，同样是不一定兼容的。</p>
<h3 id="%E5%8F%A6%E4%B8%80%E4%BA%9B%E7%9A%84%E8%A7%84%E5%88%99">另一些的规则<a class="anchor" href="#%E5%8F%A6%E4%B8%80%E4%BA%9B%E7%9A%84%E8%A7%84%E5%88%99">§</a></h3>
<ol>
<li>任何时候都禁止修改已发布的版本的内容，任何修改都必须以新版本发布</li>
<li>次版本号的升级，必须把修订号归零</li>
<li>主版本号的升级，必须把次版本号和修订号归零</li>
</ol>
<h2 id="%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%AE%9A%E4%B9%89%E4%BE%9D%E8%B5%96%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%B7">如何正确的定义依赖的版本号<a class="anchor" href="#%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%AE%9A%E4%B9%89%E4%BE%9D%E8%B5%96%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%B7">§</a></h2>
<p>在 node package 中，经常需要依赖一些 <a href="https://npmjs.com">npmjs.com</a> 上的资源，使用 <code>npm install express --save</code> 或 <code>npm install express --save-dev</code> 即可在安装的同时，把依赖关系写入 <code>package.json</code> 的 <code>dependencies</code> 或 <code>devDependencies</code> 中。</p>
<pre class="language-autoit"><code class="language-autoit">  <span class="token string">"dependencies"</span><span class="token punctuation">:</span> {
    <span class="token string">"express"</span><span class="token punctuation">:</span> <span class="token string">"^4.12.3"</span>
  }<span class="token punctuation">,</span>
</code></pre>
<p>默认会在版本号前面加上一个 <code>^</code>，在 <a href="https://npmjs.com">npm</a> 的依赖的规则中，还有 <code>~</code>、<code>&gt;</code>、<code>&lt;</code>、<code>=</code>、<code>&gt;=</code>、<code>&lt;=</code>、<code>-</code>、<code>||</code>、<code>x</code>、<code>X</code>、<code>*</code> 等符号，下面会一一解释。</p>
<h3 id=""><code>^</code><a class="anchor" href="#">§</a></h3>
<p>表示同一主版本号中，不小于指定版本号的版本号。</p>
<p>举例如下：</p>
<ul>
<li><code>^2.2.1</code> 对应主版本号为 2，不小于 <code>2.2.1</code> 的版本号，比如 <code>2.2.1</code>、<code>2.2.2</code>、<code>2.3.0</code></li>
</ul>
<h3 id="-1"><code>~</code><a class="anchor" href="#-1">§</a></h3>
<p>表示同一主版本号和次版本号中，不小于指定版本号的版本号。举例如下：</p>
<ul>
<li><code>~2.2.1</code> 对应主版本号为 2，次版本号为 2，不小于 <code>2.2.1</code> 的版本号，比如 <code>2.2.1、2.2.2</code></li>
</ul>
<h3 id="-"><code>&gt;</code>、<code>&lt;</code>、<code>=</code>、<code>&gt;=</code>、<code>&lt;=</code>、<code>-</code><a class="anchor" href="#-">§</a></h3>
<p>用来指定一个版本号范围。举例如下：</p>
<ul>
<li><code>&gt;2.1</code></li>
<li><code>1.0.0 - 1.2.0</code></li>
</ul>
<p>注意使用 <code>-</code> 的时候，必须两边都有空格。</p>
<h3 id="-2"><code>||</code><a class="anchor" href="#-2">§</a></h3>
<p>表示或，举例如下：</p>
<ul>
<li><code>^2 &lt;2.2 || &gt; 2.3</code></li>
</ul>
<h3 id="xx"><code>x</code>、<code>X</code>、<code>*</code><a class="anchor" href="#xx">§</a></h3>
<p>表示通配符，举例如下：</p>
<ul>
<li><code>*</code> 对应所有版本号</li>
<li><code>3.x</code> 对应所有主版本号为 3 的版本号</li>
</ul>
<h3 id="%E5%BC%80%E5%8F%91%E9%98%B6%E6%AE%B5%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%B7-1">开发阶段的版本号<a class="anchor" href="#%E5%BC%80%E5%8F%91%E9%98%B6%E6%AE%B5%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%B7-1">§</a></h3>
<p>开发阶段的版本号有一些例外：</p>
<p><code>^</code> 和 <code>~</code> 表示同一个意思：主版本号和次版本号都相同，不小于指定版本号。举例如下：</p>
<ul>
<li><code>^0.1.0</code> 对应主版本号为 0，次版本号为 1，不小于 <code>0.1.0</code> 的版本号，比如 <code>0.1.0</code>，<code>0.1.1</code></li>
</ul>
<h3 id="%E5%85%88%E8%A1%8C%E7%89%88%E6%9C%AC%E5%8F%B7-1">先行版本号<a class="anchor" href="#%E5%85%88%E8%A1%8C%E7%89%88%E6%9C%AC%E5%8F%B7-1">§</a></h3>
<p>先行版本号也有一些例外：</p>
<p>只有以下几种方式可以匹配到先行版本号：</p>
<ol>
<li>精确的指定版本号，如：<code>1.0.0-alpha.1</code></li>
<li>使用 <code>&gt;</code> 指定范围，如：<code>&gt;1.0.0-alpha</code>、<code>&gt;=1.0.0-rc.0 &lt;1.0.1</code></li>
<li>使用 <code>x</code>、<code>X</code>、<code>*</code> 指定所有版本号，如：<code>*</code></li>
</ol>
<h3 id="%E7%89%88%E6%9C%AC%E7%BC%96%E8%AF%91%E4%BF%A1%E6%81%AF">版本编译信息<a class="anchor" href="#%E7%89%88%E6%9C%AC%E7%BC%96%E8%AF%91%E4%BF%A1%E6%81%AF">§</a></h3>
<p>版本编译信息在判断匹配版本号的时候会被忽略，举例如下：</p>
<ul>
<li><code>3.0.2+20130313144700</code> 会匹配到 <code>3.0.2</code></li>
</ul>
<h2 id="%E6%9C%AC%E6%96%87%E5%8F%82%E8%80%83%E7%9A%84%E7%89%88%E6%9C%AC">本文参考的版本<a class="anchor" href="#%E6%9C%AC%E6%96%87%E5%8F%82%E8%80%83%E7%9A%84%E7%89%88%E6%9C%AC">§</a></h2>
<p>本文书写时（2015-04-14），参考的版本号分别为：</p>
<ul>
<li><a href="https://github.com/npm/npm/tree/v2.7.6">npm@2.7.6</a></li>
<li><a href="http://semver.org/spec/v2.0.0.html">semver.org@2.0.0</a></li>
<li><a href="https://github.com/npm/node-semver/tree/v4.3.3">semver@4.3.3</a></li>
</ul>
<p>若将来版本更新后有变，本文以以上版本号为准。</p>
<h2 id="links">Links<a class="anchor" href="#links">§</a></h2>
<ul>
<li><a href="https://npmjs.com">npm</a></li>
<li><a href="http://semver.org">semver</a></li>
<li><a href="https://github.com/npm/node-semver">node-semver</a></li>
<li><a href="http://semver.org/">http://semver.org/</a></li>
<li><a href="http://semver.org/lang/zh-CN/">http://semver.org/lang/zh-CN/</a></li>
<li><a href="http://semver.npmjs.com/">http://semver.npmjs.com/</a></li>
<li><a href="https://docs.npmjs.com/getting-started/semantic-versioning">https://docs.npmjs.com/getting-started/semantic-versioning</a></li>
<li><a href="https://docs.npmjs.com/misc/semver">https://docs.npmjs.com/misc/semver</a></li>
</ul></article></section><footer>Powered by <a href="https://github.com/xcatliu/pagic" target="_blank">Pagic</a></footer><script src="https://cdn.pagic.org/react@16.13.1/umd/react.production.min.js"></script><script src="https://cdn.pagic.org/react-dom@16.13.1/umd/react-dom.production.min.js"></script><script type="module" src="/index.js"></script></body></html>